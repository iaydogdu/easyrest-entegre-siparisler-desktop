# üì¶ Sipari≈ü Y√∂netimi Sistemi - TAMAMEN DETAYLI

## üîÑ Real-time Sipari≈ü Takibi

### Interval Sistemi
```typescript
private startRefreshInterval(): void {
  if (this.destroyed) return;

  console.log('üîÑ Refresh interval ba≈ülatƒ±lƒ±yor (10 saniye)');
  
  // 10 saniyede bir √ßalƒ±≈üan interval
  this.refreshInterval = interval(10000).subscribe(() => {
    // G√ºvenlik kontrolleri
    if (this.selectedStore && !this.loading && !this.destroyed && this.isPageVisible) {
      console.log('‚è∞ Scheduled refresh √ßalƒ±≈üƒ±yor...');
      
      // 1. Silent refresh
      this.silentRefresh();

      // 2. Sync status'larƒ± g√ºncelle
      this.updateTrendyolSyncStatus();
      this.updateTrendyolRefundSyncStatus();
      this.updateYemeksepetiRefundSyncStatus();
    } else {
      console.log('‚è∏Ô∏è Refresh atlandƒ±:', {
        selectedStore: !!this.selectedStore,
        loading: this.loading,
        destroyed: this.destroyed,
        pageVisible: this.isPageVisible
      });
    }
  });
}
```

### Silent Refresh Algoritmasƒ±
```typescript
silentRefresh(): void {
  // 1. G√ºvenlik kontrolleri
  if (!this.selectedStore || this.destroyed) {
    console.log('‚ùå Silent refresh iptal: Store yok veya component destroyed');
    return;
  }

  // 2. ƒ∞≈ülem devam ediyor mu kontrol et
  if (this.isRefreshing) {
    console.log('‚è≥ √ñnceki silent refresh hen√ºz bitmedi, yeni istek engellendi');
    return;
  }

  // 3. Loading durumunda istek yapma
  if (this.loading) {
    console.log('‚è≥ Loading durumunda silent refresh atlandƒ±');
    return;
  }

  // 4. Minimum interval kontrol√º (debouncing)
  const now = Date.now();
  if (now - this.lastRefreshTime < this.MIN_REFRESH_INTERVAL_MS) {
    console.log('‚è±Ô∏è √áok hƒ±zlƒ± refresh denemesi engellendi, minimum 8 saniye bekle');
    return;
  }

  // 5. Page visibility kontrol√º
  if (!this.isPageVisible) {
    console.log('üëÅÔ∏è Sayfa g√∂r√ºn√ºr deƒüil, silent refresh atlandƒ±');
    return;
  }

  console.log('üîÑ Silent refresh ba≈ülatƒ±ldƒ±...');
  this.isRefreshing = true;
  this.lastRefreshTime = now;

  const storeId = typeof this.selectedStore === 'object' ?
    (this.selectedStore as any)._id || '' :
    this.selectedStore.toString();

  // 6. Timeout ile request'i sƒ±nƒ±rla
  const timeoutId = setTimeout(() => {
    if (this.isRefreshing && !this.destroyed) {
      console.warn('‚è∞ Silent refresh timeout (20s) - flag sƒ±fƒ±rlanƒ±yor');
      this.isRefreshing = false;
      this.consecutiveFailures++;

      // Ardƒ±≈üƒ±k ba≈üarƒ±sƒ±zlƒ±k kontrol√º
      if (this.consecutiveFailures >= this.MAX_CONSECUTIVE_FAILURES) {
        this.handleConsecutiveFailures();
      }
    }
  }, this.SILENT_REFRESH_TIMEOUT_MS);

  // 7. API request
  this.entegreSiparisService.getAggregatedOrders(storeId).subscribe({
    next: (response: OrderResponse) => {
      clearTimeout(timeoutId);

      if (this.destroyed) {
        console.log('üóëÔ∏è Component destroyed during silent refresh response');
        this.isRefreshing = false;
        return;
      }

      try {
        if (response.success && response.data) {
          console.log(`üì¶ Silent refresh ba≈üarƒ±lƒ±: ${response.data.orders?.length || 0} sipari≈ü`);
          
          // Sipari≈üleri i≈üle
          this.processOrders(response.data.orders || []);

          // √ñzeti g√ºncelle
          this.updateSummary();

          // Filtrelenmi≈ü sipari≈üleri g√ºncelle
          this.filteredOrders = [...this.orders];
          this.filteredOrder(this.currentFilter || 'ALL');

          // Otomatik onaylama kontrol√º
          if (this.isAutoApproveEnabled && !this.destroyed) {
            this.checkAndApproveOrders();
          }

          // Ba≈üarƒ±lƒ± refresh sonrasƒ± failure sayacƒ±nƒ± sƒ±fƒ±rla
          this.consecutiveFailures = 0;
          
          console.log(`‚úÖ Silent refresh tamamlandƒ±: ${this.orders.length} sipari≈ü aktif`);
        } else {
          console.warn('‚ö†Ô∏è Silent refresh: Invalid response format', response);
        }
      } catch (error) {
        console.error('‚ùå Silent refresh data processing error:', error);
      } finally {
        this.isRefreshing = false;
      }
    },
    error: (error) => {
      clearTimeout(timeoutId);

      if (this.destroyed) {
        console.log('üóëÔ∏è Component destroyed during silent refresh error');
        return;
      }

      console.error('üí• Silent refresh API hatasƒ±:', error);
      this.isRefreshing = false;
      this.consecutiveFailures++;

      // √áok fazla hata varsa otomatik reload uyarƒ±sƒ±
      if (this.consecutiveFailures >= this.MAX_CONSECUTIVE_FAILURES) {
        this.handleConsecutiveFailures();
      }

      // Loading state'i temizle
      if (this.loading) {
        this.loading = false;
      }
    }
  });
}
```

### Ardƒ±≈üƒ±k Hata Y√∂netimi
```typescript
private handleConsecutiveFailures(): void {
  console.error(`üí• ${this.consecutiveFailures} ardƒ±≈üƒ±k hata tespit edildi!`);
  
  this.notificationService.showNotification(
    `S√ºrekli baƒülantƒ± hatasƒ± tespit edildi (${this.consecutiveFailures} kez). Uygulama 60 saniye i√ßinde otomatik yenilenecek...`,
    'error',
    'top-end',
    10000
  );

  // 60 saniye sonra otomatik reload
  setTimeout(() => {
    if (!this.destroyed) {
      console.log('üîÑ Ardƒ±≈üƒ±k hata nedeniyle otomatik reload ger√ßekle≈ütiriliyor...');
      
      // Electron'da window reload
      if (typeof window !== 'undefined' && window.electronAPI) {
        window.electronAPI.reloadWindow?.();
      } else {
        window.location.reload();
      }
    }
  }, this.AUTO_RELOAD_DELAY_MS);
}
```

## üìä Sipari≈ü ƒ∞≈üleme Algoritmasƒ±

### Batch Processing Sistemi
```typescript
private processOrders(orders: any[]): void {
  if (!Array.isArray(orders) || this.destroyed) {
    console.warn('‚ùå processOrders: Ge√ßersiz sipari≈ü verisi veya component destroyed');
    return;
  }

  console.log(`‚öôÔ∏è ${orders.length} sipari≈ü i≈üleniyor...`);
  const startTime = Date.now();

  // Performans metrikleri
  const metrics = {
    total: orders.length,
    processed: 0,
    newOrders: 0,
    errors: 0,
    platforms: {
      trendyol: 0,
      yemeksepeti: 0,
      migros: 0,
      getir: 0,
      unknown: 0
    }
  };

  // Mevcut sipari≈üleri temizle
  this.orders = [];
  this.newOrders.clear(); // √ñnceki yeni sipari≈ü i≈üaretlerini temizle

  // Batch processing i√ßin orders'ƒ± chunk'lara b√∂l
  const batchSize = 50;
  const batches = [];
  for (let i = 0; i < orders.length; i += batchSize) {
    batches.push(orders.slice(i, i + batchSize));
  }

  console.log(`üì¶ ${batches.length} batch halinde i≈ülenecek (batch size: ${batchSize})`);

  // Her batch'i process et
  batches.forEach((batch, batchIndex) => {
    if (this.destroyed) return;

    console.log(`‚öôÔ∏è Batch ${batchIndex + 1}/${batches.length} i≈üleniyor (${batch.length} sipari≈ü)`);

    batch.forEach((order, orderIndex) => {
      if (this.destroyed) return;

      try {
        if (!order?.rawData) {
          console.warn(`‚ö†Ô∏è Sipari≈ü ${orderIndex} rawData eksik:`, order);
          metrics.errors++;
          return;
        }

        const updatedOrder = this.processOrderByPlatform(order);
        
        if (updatedOrder) {
          this.orders.push(updatedOrder);
          metrics.processed++;
          
          // Platform sayacƒ±nƒ± artƒ±r
          const platform = updatedOrder.type.toLowerCase();
          if (platform in metrics.platforms) {
            metrics.platforms[platform as keyof typeof metrics.platforms]++;
          } else {
            metrics.platforms.unknown++;
          }

          // Yeni sipari≈ü kontrol√º
          if (this.isNewOrder(updatedOrder)) {
            const orderId = this.getOrderId(updatedOrder);
            if (orderId) {
              this.newOrders.add(orderId);
              metrics.newOrders++;

              console.log(`üÜï Yeni sipari≈ü tespit edildi: ${orderId} (${updatedOrder.type})`);

              // Ses ve bildirim sistemi
              this.handleNewOrderNotification(updatedOrder, orderId);
            }
          }
        }
      } catch (error) {
        console.error(`‚ùå Sipari≈ü i≈üleme hatasƒ± (batch ${batchIndex}, order ${orderIndex}):`, error, order);
        metrics.errors++;
      }
    });

    // Son batch'te sƒ±ralama yap
    if (batchIndex === batches.length - 1 && !this.destroyed) {
      this.sortOrders();
    }
  });

  const endTime = Date.now();
  const processingTime = endTime - startTime;
  
  console.log('üìä Sipari≈ü i≈üleme tamamlandƒ±:', {
    ...metrics,
    processingTime: `${processingTime}ms`,
    avgTimePerOrder: `${(processingTime / metrics.total).toFixed(2)}ms`
  });

  // Performance warning
  if (processingTime > 5000) {
    console.warn(`‚ö†Ô∏è Yava≈ü i≈üleme tespit edildi: ${processingTime}ms (${metrics.total} sipari≈ü)`);
  }
}
```

### Platform-Specific ƒ∞≈üleme
```typescript
private processOrderByPlatform(order: any): Order | null {
  const platform = order.platform?.toLowerCase();
  
  try {
    switch (platform) {
      case 'yemeksepeti':
        return this.processYemekSepetiOrder(order);
        
      case 'getir':
        return this.processGetirOrder(order);
        
      case 'trendyol':
        return this.processTrendyolOrder(order);
        
      case 'migros':
        return this.processMigrosOrder(order);
        
      default:
        console.warn(`‚ö†Ô∏è Bilinmeyen platform: ${platform}`, order);
        return null;
    }
  } catch (error) {
    console.error(`‚ùå ${platform} sipari≈üi i≈ülenirken hata:`, error, order);
    return null;
  }
}

private processYemekSepetiOrder(order: any): Order {
  const processedOrder: Order = {
    ...order,
    type: 'YEMEKSEPETI',
    status: order.status || 'new',
    rawData: {
      ...order.rawData,
      // YemekSepeti specific validations
      shortCode: order.rawData.shortCode || '',
      code: order.rawData.code || '',
      expeditionType: order.rawData.expeditionType || 'delivery'
    }
  };

  // √úr√ºn kontrol√º
  if (!order.rawData.products || !Array.isArray(order.rawData.products)) {
    console.warn('‚ö†Ô∏è YemekSepeti sipari≈üinde √ºr√ºn listesi eksik:', order.rawData.shortCode);
  }

  // M√º≈üteri bilgisi kontrol√º
  if (!order.rawData.customer) {
    console.warn('‚ö†Ô∏è YemekSepeti sipari≈üinde m√º≈üteri bilgisi eksik:', order.rawData.shortCode);
  }

  return processedOrder;
}

private processGetirOrder(order: any): Order {
  const processedOrder: Order = {
    ...order,
    type: 'GETIR',
    status: order.status || 'new',
    rawData: {
      ...order.rawData,
      // Getir specific validations
      confirmationId: order.rawData.confirmationId || order.rawData.id || '',
      isScheduled: order.rawData.isScheduled || false,
      deliveryType: order.rawData.deliveryType || 2
    }
  };

  // Scheduled order kontrol√º
  if (order.rawData.isScheduled && !order.rawData.scheduledDate) {
    console.warn('‚ö†Ô∏è Getir ileri tarihli sipari≈üinde tarih eksik:', order.rawData.confirmationId);
  }

  return processedOrder;
}

private processTrendyolOrder(order: any): Order {
  const processedOrder: Order = {
    ...order,
    type: 'TRENDYOL',
    status: order.status || 'new',
    rawData: {
      ...order.rawData,
      // Trendyol specific validations
      orderNumber: order.rawData.orderNumber || '',
      packageStatus: order.rawData.packageStatus || 'Created',
      totalPrice: order.rawData.totalPrice || 0
    }
  };

  // Lines kontrol√º
  if (!order.rawData.lines || !Array.isArray(order.rawData.lines)) {
    console.warn('‚ö†Ô∏è Trendyol sipari≈üinde √ºr√ºn lines eksik:', order.rawData.orderNumber);
  }

  return processedOrder;
}

private processMigrosOrder(order: any): Order {
  const processedOrder: Order = {
    ...order,
    type: 'MIGROS',
    status: order.status || 'NEW_PENDING',
    rawData: {
      ...order.rawData,
      // Migros specific validations
      orderId: order.rawData.orderId || '',
      platformConfirmationId: order.rawData.platformConfirmationId || ''
    }
  };

  // Items kontrol√º
  if (!order.rawData.items && !order.rawData.products) {
    console.warn('‚ö†Ô∏è Migros sipari≈üinde √ºr√ºn listesi eksik:', order.rawData.orderId);
  }

  return processedOrder;
}
```

## üéØ Yeni Sipari≈ü Tespit Algoritmasƒ±

### Platform-Agnostic Yeni Sipari≈ü Kontrol√º
```typescript
isNewOrder(order: Order): boolean {
  if (!order?.status) {
    console.warn('‚ö†Ô∏è Sipari≈ü status bilgisi eksik:', order);
    return false;
  }

  const status = order.status.toString().toLowerCase();
  const orderId = this.getOrderId(order);
  
  console.log(`üîç Yeni sipari≈ü kontrol√º: ${orderId} (${order.type}) - Status: ${status}`);

  // Platform-specific kontroller
  const isNew = this.checkNewOrderByPlatform(order, status);
  
  if (isNew) {
    console.log(`üÜï YENƒ∞ Sƒ∞PARƒ∞≈û TESPƒ∞T EDƒ∞LDƒ∞: ${orderId} (${order.type})`);
  }
  
  return isNew;
}

private checkNewOrderByPlatform(order: Order, status: string): boolean {
  switch (order.type) {
    case 'GETIR':
      return this.isNewOrder_Getir(order, status);
      
    case 'YEMEKSEPETI':
      return this.isNewOrder_YemekSepeti(order, status);
      
    case 'TRENDYOL':
      return this.isNewOrder_Trendyol(order, status);
      
    case 'MIGROS':
      return this.isNewOrder_Migros(order, status);
      
    default:
      console.warn(`‚ö†Ô∏è Bilinmeyen platform i√ßin yeni sipari≈ü kontrol√º: ${order.type}`);
      return false;
  }
}

private isNewOrder_Getir(order: Order, status: string): boolean {
  // ƒ∞leri tarihli sipari≈ü kontrol√º
  if (order.rawData?.isScheduled) {
    const isScheduledNew = status === '325' || status === '1600';
    if (isScheduledNew) {
      console.log(`üìÖ ƒ∞leri tarihli Getir sipari≈üi: ${this.getOrderId(order)} - ${order.rawData.scheduledDate}`);
    }
    return isScheduledNew;
  }
  
  // Normal sipari≈ü kontrol√º
  return status === '400';
}

private isNewOrder_YemekSepeti(order: Order, status: string): boolean {
  const isNew = status === 'processed' || status === 'received';
  
  if (isNew) {
    const expeditionType = order.rawData.expeditionType;
    console.log(`üçΩÔ∏è Yeni YemekSepeti sipari≈üi: ${this.getOrderId(order)} - Tip: ${expeditionType}`);
  }
  
  return isNew;
}

private isNewOrder_Trendyol(order: Order, status: string): boolean {
  // Trendyol i√ßin package status kontrol√º
  const packageStatus = order.rawData?.packageStatus?.toLowerCase();
  const isNew = packageStatus === 'created';
  
  if (isNew) {
    console.log(`üõí Yeni Trendyol sipari≈üi: ${this.getOrderId(order)} - Package Status: ${packageStatus}`);
  }
  
  return isNew;
}

private isNewOrder_Migros(order: Order, status: string): boolean {
  const isNew = status === 'new_pending' || status.includes('new');
  
  if (isNew) {
    const deliveryProvider = order.rawData.deliveryProvider || order.rawData.delivery?.provider;
    console.log(`üõçÔ∏è Yeni Migros sipari≈üi: ${this.getOrderId(order)} - Provider: ${deliveryProvider}`);
  }
  
  return isNew;
}
```

## üîî Yeni Sipari≈ü Bildirim Sistemi

### Bildirim ƒ∞≈ü Akƒ±≈üƒ±
```typescript
private handleNewOrderNotification(order: Order, orderId: string): void {
  console.log(`üîî Yeni sipari≈ü bildirimi ba≈ülatƒ±lƒ±yor: ${orderId}`);
  
  // 1. Ses bildirimi
  if (this.isSoundEnabled && !this.destroyed) {
    this.startSound();
  }

  // 2. Desktop notification
  this.showDesktopNotification(
    `Yeni ${this.getSourceText(order.type)} Sipari≈üi!`,
    this.generateNotificationMessage(order)
  );

  // 3. Electron'a bildir (tray icon flash)
  if (typeof window !== 'undefined' && window.electronAPI) {
    window.electronAPI.showOrderNotification?.({
      orderId,
      platform: order.type,
      amount: this.getOrderAmount(order),
      customerName: this.getCustomerName(order),
      orderType: this.getOrderType(order)
    });
  }

  // 4. Browser title flash
  this.flashBrowserTitle(orderId);
}

private generateNotificationMessage(order: Order): string {
  const orderId = this.getOrderId(order);
  const amount = this.formatPrice(this.getOrderAmount(order));
  const customerName = this.getCustomerName(order);
  const orderType = this.getOrderType(order);
  
  let message = `Sipari≈ü No: ${orderId}\n`;
  message += `Tutar: ${amount} ‚Ç∫\n`;
  message += `Tip: ${orderType}\n`;
  
  if (customerName) {
    message += `M√º≈üteri: ${customerName}`;
  }
  
  return message;
}

private flashBrowserTitle(orderId: string): void {
  const originalTitle = document.title;
  let flashCount = 0;
  const maxFlashes = 6;
  
  const flashInterval = setInterval(() => {
    document.title = flashCount % 2 === 0 
      ? `üÜï Yeni Sipari≈ü! - ${orderId}` 
      : originalTitle;
    
    flashCount++;
    
    if (flashCount >= maxFlashes) {
      clearInterval(flashInterval);
      document.title = originalTitle;
    }
  }, 1000);
}
```

## üìà Sipari≈ü Sƒ±ralama ve Filtreleme

### Geli≈ümi≈ü Sƒ±ralama Algoritmasƒ±
```typescript
private sortOrders(): void {
  if (this.destroyed || !this.orders.length) return;

  console.log('üìä Sipari≈üler sƒ±ralanƒ±yor...');
  const startTime = Date.now();

  try {
    this.orders.sort((a, b) => {
      // 1. √ñncelik: Yeni sipari≈üler en √ºstte
      const isNewA = this.isNewOrder(a);
      const isNewB = this.isNewOrder(b);

      if (isNewA && !isNewB) return -1;
      if (!isNewA && isNewB) return 1;

      // 2. √ñncelik: ƒ∞leri tarihli sipari≈üler (Getir)
      const isScheduledA = a.type === 'GETIR' && a.rawData?.isScheduled;
      const isScheduledB = b.type === 'GETIR' && b.rawData?.isScheduled;

      if (isScheduledA && !isScheduledB) return -1;
      if (!isScheduledA && isScheduledB) return 1;

      // 3. √ñncelik: Platform sƒ±rasƒ± (Trendyol > YemekSepeti > Migros > Getir)
      const platformPriority = {
        'TRENDYOL': 4,
        'YEMEKSEPETI': 3,
        'MIGROS': 2,
        'GETIR': 1
      };
      
      const priorityA = platformPriority[a.type as keyof typeof platformPriority] || 0;
      const priorityB = platformPriority[b.type as keyof typeof platformPriority] || 0;
      
      if (priorityA !== priorityB) {
        return priorityB - priorityA;
      }

      // 4. Son √∂ncelik: Tarih (yeni olan √ºstte)
      const dateA = new Date(a.createdAt).getTime();
      const dateB = new Date(b.createdAt).getTime();

      return dateB - dateA;
    });

    const endTime = Date.now();
    console.log(`‚úÖ Sƒ±ralama tamamlandƒ±: ${endTime - startTime}ms`);
    
  } catch (error) {
    console.error('‚ùå Sipari≈ü sƒ±ralama hatasƒ±:', error);
  }
}
```

### Filtreleme Sistemi
```typescript
currentFilter: string = 'ALL';

filteredOrder(type: string): void {
  console.log(`üîç Sipari≈ü filtreleniyor: ${type}`);
  
  this.currentFilter = type;
  
  if (type === 'ALL') {
    this.filteredOrders = [...this.orders];
    console.log(`üìä T√ºm sipari≈üler g√∂steriliyor: ${this.filteredOrders.length}`);
  } else {
    this.filteredOrders = this.orders.filter(order => order.type === type);
    console.log(`üìä ${type} sipari≈üleri g√∂steriliyor: ${this.filteredOrders.length}`);
  }

  // Filtreleme sonrasƒ± √∂zeti g√ºncelle
  this.updateFilteredSummary();
}

private updateFilteredSummary(): void {
  const filteredSummary = {
    total: this.filteredOrders.length,
    new: this.filteredOrders.filter(o => this.isNewOrder(o)).length,
    approved: this.filteredOrders.filter(o => this.approvedOrders.has(this.getOrderId(o))).length,
    completed: this.filteredOrders.filter(o => this.isOrderCompleted(o)).length
  };

  console.log(`üìä Filtrelenmi≈ü √∂zet (${this.currentFilter}):`, filteredSummary);
}
```

## üé® UI State Management

### Loading States
```typescript
// Farklƒ± loading durumlarƒ±
loadingStates = {
  initial: false,        // ƒ∞lk y√ºkleme
  refresh: false,        // Manual refresh
  silentRefresh: false,  // Background refresh
  storeChange: false,    // Maƒüaza deƒüi≈üimi
  orderApproval: false   // Sipari≈ü onaylama
};

setLoadingState(type: keyof typeof this.loadingStates, value: boolean): void {
  this.loadingStates[type] = value;
  
  // Global loading state
  this.loading = Object.values(this.loadingStates).some(state => state);
  
  console.log(`üîÑ Loading state deƒüi≈üti: ${type} = ${value}`, this.loadingStates);
}
```

### Error States
```typescript
errorStates = {
  connection: false,     // Baƒülantƒ± hatasƒ±
  authentication: false, // Auth hatasƒ±
  storeLoad: false,      // Maƒüaza y√ºkleme hatasƒ±
  orderLoad: false,      // Sipari≈ü y√ºkleme hatasƒ±
  approval: false        // Onaylama hatasƒ±
};

setErrorState(type: keyof typeof this.errorStates, value: boolean, message?: string): void {
  this.errorStates[type] = value;
  
  if (value && message) {
    console.error(`‚ùå Error state: ${type} - ${message}`);
    this.notificationService.showNotification(message, 'error', 'top-end');
  }
  
  // Global error state
  const hasErrors = Object.values(this.errorStates).some(state => state);
  
  if (hasErrors) {
    console.warn('‚ö†Ô∏è Sistem hatasƒ± tespit edildi:', this.errorStates);
  }
}
```

## üîä Geli≈ümi≈ü Ses Sistemi

### Multi-Audio Support
```typescript
private audioFiles = {
  newOrder: '/assets/sounds/web.mp3',
  success: '/assets/sounds/success.mp3',
  error: '/assets/sounds/error.mp3',
  warning: '/assets/sounds/warning.mp3'
};

private audioInstances: { [key: string]: HTMLAudioElement } = {};

private async initializeAudio(): Promise<void> {
  console.log('üîä Geli≈ümi≈ü ses sistemi ba≈ülatƒ±lƒ±yor...');
  
  const loadPromises = Object.entries(this.audioFiles).map(([key, src]) => {
    return new Promise<void>((resolve) => {
      try {
        const audio = new Audio(src);
        audio.preload = 'auto';
        audio.volume = 0.7;
        
        audio.addEventListener('canplaythrough', () => {
          console.log(`‚úÖ Ses dosyasƒ± y√ºklendi: ${key}`);
          this.audioInstances[key] = audio;
          resolve();
        }, { once: true });
        
        audio.addEventListener('error', (error) => {
          console.error(`‚ùå Ses dosyasƒ± hatasƒ± (${key}):`, error);
          resolve(); // Hata olsa da devam et
        }, { once: true });
        
        audio.load();
        
        // Timeout
        setTimeout(() => resolve(), 3000);
        
      } catch (error) {
        console.error(`‚ùå Audio instance olu≈üturma hatasƒ± (${key}):`, error);
        resolve();
      }
    });
  });

  await Promise.all(loadPromises);
  console.log(`‚úÖ Ses sistemi hazƒ±r: ${Object.keys(this.audioInstances).length} dosya y√ºklendi`);
}

private playSound(type: 'newOrder' | 'success' | 'error' | 'warning'): void {
  if (!this.isSoundEnabled || this.destroyed) return;

  const audio = this.audioInstances[type];
  if (!audio) {
    console.warn(`‚ö†Ô∏è Ses dosyasƒ± bulunamadƒ±: ${type}`);
    return;
  }

  console.log(`üîä Ses √ßalƒ±nƒ±yor: ${type}`);
  
  audio.currentTime = 0;
  audio.play().then(() => {
    console.log(`‚úÖ Ses ba≈üarƒ±yla √ßalƒ±ndƒ±: ${type}`);
    
    // Yeni sipari≈ü sesi i√ßin √∂zel i≈ülem
    if (type === 'newOrder') {
      this.handleNewOrderSound();
    }
  }).catch(error => {
    console.error(`‚ùå Ses √ßalma hatasƒ± (${type}):`, error);
  });
}

private handleNewOrderSound(): void {
  // Yeni sipari≈ü sesi √ßaldƒ±ƒüƒ±nda loop yapacak mƒ± kontrol et
  const hasUnconfirmedOrders = this.orders.some(order => this.isNewOrder(order));
  
  if (hasUnconfirmedOrders && !this.isAutoApproveEnabled) {
    // Otomatik onay kapalƒ±ysa ses loop'a girsin
    this.startSoundLoop();
  }
}

private startSoundLoop(): void {
  if (this.soundInterval) return;

  console.log('üîÑ Ses loop ba≈ülatƒ±lƒ±yor...');
  
  this.soundInterval = setInterval(() => {
    if (!this.destroyed && this.isSoundEnabled && !this.isAutoApproveEnabled) {
      const hasUnconfirmedOrders = this.orders.some(order => this.isNewOrder(order));
      
      if (hasUnconfirmedOrders) {
        this.playSound('newOrder');
        // UI animasyonlarƒ± i√ßin refresh
        this.filteredOrders = [...this.filteredOrders];
      } else {
        this.stopSoundLoop();
      }
    } else {
      this.stopSoundLoop();
    }
  }, 5000); // 5 saniyede bir tekrarla
}

private stopSoundLoop(): void {
  if (this.soundInterval) {
    console.log('üîá Ses loop durduruluyor...');
    clearInterval(this.soundInterval);
    this.soundInterval = null;
  }
}
```

## üéØ Sipari≈ü Detay Y√∂netimi

### Sipari≈ü A√ßma/Kapama
```typescript
openOrderDetails(order: Order): void {
  console.log('üìã Sipari≈ü detayƒ± a√ßƒ±lƒ±yor:', this.getOrderId(order));
  
  // Detay a√ßƒ±ldƒ±ƒüƒ±nda yeni sipari≈ü i≈üaretini temizle
  const orderId = this.getOrderId(order);
  if (orderId && this.newOrders.has(orderId)) {
    this.newOrders.delete(orderId);
    console.log('üè∑Ô∏è Yeni sipari≈ü i≈üareti temizlendi:', orderId);

    // Ses kontrol√º
    const hasUnconfirmedOrders = this.orders.some(o => this.isNewOrder(o));
    if (!hasUnconfirmedOrders) {
      this.stopSound();
      this.stopSoundLoop();
    }
  }
  
  this.selectedOrder = order;
  
  // Detaylƒ± log
  console.log('üìä Sipari≈ü detaylarƒ±:', {
    orderId,
    platform: order.type,
    status: order.status,
    customerName: this.getCustomerName(order),
    amount: this.getOrderAmount(order),
    productCount: this.getProducts(order).length,
    hasMapping: !this.hasAnyMapping(order),
    hasPaymentMapping: this.hasPaymentMapping(order),
    canAutoApprove: this.canAutoApproveOrder(order)
  });
}

closeOrderDetails(): void {
  console.log('‚ùå Sipari≈ü detayƒ± kapatƒ±lƒ±yor');
  this.selectedOrder = null;
}
```

### Sipari≈ü ID Alma (Platform-Specific)
```typescript
getOrderId(order: Order): string {
  if (!order?.rawData) {
    console.warn('‚ö†Ô∏è getOrderId: rawData eksik');
    return '';
  }

  let orderId = '';

  switch (order.type) {
    case 'YEMEKSEPETI':
      const shortCode = order.rawData.shortCode || '';
      const code = order.rawData.code || '';
      orderId = shortCode ? `${shortCode} (${code})` : code;
      break;
      
    case 'GETIR':
      orderId = order.rawData.confirmationId || order.rawData.id || '';
      break;
      
    case 'TRENDYOL':
      const orderNumber = order.rawData.orderNumber || '';
      const orderCode = order.rawData.orderCode || '';
      orderId = orderCode ? `${orderNumber} (${orderCode})` : orderNumber;
      break;
      
    case 'MIGROS':
      const migrosOrderId = order.rawData.orderId || '';
      const confirmationId = order.rawData.platformConfirmationId || '';
      orderId = confirmationId ? `${migrosOrderId} (${confirmationId})` : migrosOrderId.toString();
      break;
      
    default:
      console.warn(`‚ö†Ô∏è Bilinmeyen platform i√ßin order ID: ${order.type}`);
      orderId = order.rawData.id || order.rawData.orderNumber || order.rawData.orderId || '';
  }

  if (!orderId) {
    console.error(`‚ùå Order ID bulunamadƒ±:`, order);
  }

  return orderId;
}
```

## üí∞ Fiyat Hesaplama Sistemi

### Platform-Specific Fiyat Hesaplama
```typescript
getOrderAmount(order: Order): number {
  if (!order?.rawData) {
    console.warn('‚ö†Ô∏è getOrderAmount: rawData eksik');
    return 0;
  }

  let amount = 0;

  try {
    switch (order.type) {
      case 'YEMEKSEPETI':
        amount = this.calculateYemekSepetiAmount(order);
        break;
        
      case 'GETIR':
        amount = this.calculateGetirAmount(order);
        break;
        
      case 'TRENDYOL':
        amount = this.calculateTrendyolAmount(order);
        break;
        
      case 'MIGROS':
        amount = this.calculateMigrosAmount(order);
        break;
        
      default:
        console.warn(`‚ö†Ô∏è Bilinmeyen platform i√ßin fiyat hesaplama: ${order.type}`);
        amount = 0;
    }

    // Fiyat validasyonu
    if (isNaN(amount) || amount < 0) {
      console.error(`‚ùå Ge√ßersiz fiyat hesaplandƒ±: ${amount}`, order);
      amount = 0;
    }

    // 2 ondalƒ±k basamaƒüa yuvarla
    amount = Math.round(amount * 100) / 100;
    
    console.log(`üí∞ Fiyat hesaplandƒ± (${order.type}): ${amount} ‚Ç∫`);
    
  } catch (error) {
    console.error(`‚ùå Fiyat hesaplama hatasƒ± (${order.type}):`, error, order);
    amount = 0;
  }

  return amount;
}

private calculateYemekSepetiAmount(order: Order): number {
  return order.rawData.price?.grandTotal || 0;
}

private calculateGetirAmount(order: Order): number {
  // √ñnce indirimli fiyatƒ± kontrol et
  if (order.rawData.totalDiscountedPrice !== undefined && order.rawData.totalDiscountedPrice !== null) {
    return Number(order.rawData.totalDiscountedPrice) || 0;
  }
  
  // Sonra diƒüer fiyat alanlarƒ±nƒ± kontrol et
  return order.rawData.discountedAmount || 
         order.rawData.totalPrice || 
         order.rawData.totalAmount || 0;
}

private calculateTrendyolAmount(order: Order): number {
  let totalDiscount = 0;
  const basePrice = order.rawData.totalPrice || 0;

  // ƒ∞ndirim hesaplama
  if (order.rawData?.lines && Array.isArray(order.rawData.lines)) {
    order.rawData.lines.forEach(line => {
      if (line.items && Array.isArray(line.items)) {
        line.items.forEach(item => {
          // Seller promosyon indirimleri
          if (item.promotions && Array.isArray(item.promotions)) {
            item.promotions.forEach(promo => {
              if (promo.amount && promo.amount.seller) {
                totalDiscount += Number(promo.amount.seller) || 0;
              }
            });
          }

          // Seller kupon indirimleri
          if (item.coupon && item.coupon.amount && item.coupon.amount.seller) {
            totalDiscount += Number(item.coupon.amount.seller) || 0;
          }
        });
      }
    });
  }

  const finalAmount = basePrice - totalDiscount;
  console.log(`üí∞ Trendyol fiyat hesaplandƒ±: ${basePrice} - ${totalDiscount} = ${finalAmount}`);
  
  return finalAmount;
}

private calculateMigrosAmount(order: Order): number {
  const rawData: any = order.rawData;
  
  // √ñnce direkt amount alanlarƒ±nƒ± kontrol et
  if (rawData.totalAmount || rawData.discountedAmount) {
    return Number(rawData.discountedAmount) || Number(rawData.totalAmount) || 0;
  }
  
  // Prices objesi kontrol√º (penny'den TL'ye √ßevir)
  if (rawData.prices) {
    if (rawData.prices.restaurantDiscounted?.amountAsPenny) {
      return Math.round((rawData.prices.restaurantDiscounted.amountAsPenny / 100) * 100) / 100;
    }
    else if (rawData.prices.discounted?.amountAsPenny) {
      return Math.round((rawData.prices.discounted.amountAsPenny / 100) * 100) / 100;
    }
    else if (rawData.prices.total?.amountAsPenny) {
      return Math.round((rawData.prices.total.amountAsPenny / 100) * 100) / 100;
    }
  }

  console.warn('‚ö†Ô∏è Migros sipari≈üinde fiyat bilgisi bulunamadƒ±:', rawData.orderId);
  return 0;
}
```

## üë§ M√º≈üteri Bilgileri ƒ∞≈üleme

### Platform-Specific M√º≈üteri Adƒ±
```typescript
getCustomerName(order: Order): string {
  if (!order?.rawData) return '';

  let customerName = '';

  try {
    switch (order.type) {
      case 'YEMEKSEPETI':
        const ysCustomer = order.rawData.customer;
        customerName = `${ysCustomer?.firstName || ''} ${ysCustomer?.lastName || ''}`.trim();
        break;
        
      case 'GETIR':
        customerName = order.rawData.client?.name || '';
        break;
        
      case 'TRENDYOL':
        const tyCustomer = order.rawData.customer;
        customerName = `${tyCustomer?.firstName || ''} ${tyCustomer?.lastName || ''}`.trim();
        break;
        
      case 'MIGROS':
        if (order.rawData.customerInfo?.name) {
          customerName = order.rawData.customerInfo.name;
        } else if (order.rawData.customer) {
          const customer: any = order.rawData.customer;
          customerName = customer.fullName || `${customer.firstName || ''} ${customer.lastName || ''}`.trim();
        }
        break;
        
      default:
        console.warn(`‚ö†Ô∏è Bilinmeyen platform i√ßin m√º≈üteri adƒ±: ${order.type}`);
    }

    if (!customerName) {
      console.warn(`‚ö†Ô∏è M√º≈üteri adƒ± bulunamadƒ± (${order.type}):`, this.getOrderId(order));
      customerName = 'M√º≈üteri Bilgisi Yok';
    }

  } catch (error) {
    console.error(`‚ùå M√º≈üteri adƒ± alma hatasƒ± (${order.type}):`, error, order);
    customerName = 'Hata: M√º≈üteri Bilgisi';
  }

  return customerName;
}

getCustomerPhone(order: Order): string {
  if (!order?.rawData) return '';

  let phone = '';

  try {
    switch (order.type) {
      case 'YEMEKSEPETI':
        phone = order.rawData.customer?.mobilePhone || '';
        break;
        
      case 'GETIR':
        phone = order.rawData.client?.contactPhoneNumber || '';
        break;
        
      case 'TRENDYOL':
        phone = order.rawData.callCenterPhone || order.rawData.address?.phone || '';
        break;
        
      case 'MIGROS':
        if (order.rawData.customerInfo?.phone) {
          phone = order.rawData.customerInfo.phone;
        } else if (order.rawData.customer) {
          const customer: any = order.rawData.customer;
          phone = customer.phoneNumber || '';
        }
        break;
    }

    // Telefon numarasƒ± formatƒ± kontrol√º
    if (phone && !/^[\d\s\+\-\(\)]+$/.test(phone)) {
      console.warn(`‚ö†Ô∏è Ge√ßersiz telefon formatƒ± (${order.type}): ${phone}`);
    }

  } catch (error) {
    console.error(`‚ùå Telefon numarasƒ± alma hatasƒ± (${order.type}):`, error);
  }

  return phone;
}
```

## üìç Adres ƒ∞≈üleme Sistemi

### Geli≈ümi≈ü Adres Parser
```typescript
getDeliveryAddress(order: Order): {
  address?: string;
  doorNo?: string;
  floor?: string;
  description?: string;
  coordinates?: { lat: number; lng: number };
  fullAddress?: string;
} {
  if (!order?.rawData) return {};

  try {
    switch (order.type) {
      case 'GETIR':
        return this.parseGetirAddress(order);
        
      case 'YEMEKSEPETI':
        return this.parseYemekSepetiAddress(order);
        
      case 'TRENDYOL':
        return this.parseTrendyolAddress(order);
        
      case 'MIGROS':
        return this.parseMigrosAddress(order);
        
      default:
        console.warn(`‚ö†Ô∏è Bilinmeyen platform i√ßin adres: ${order.type}`);
        return {};
    }
  } catch (error) {
    console.error(`‚ùå Adres i≈üleme hatasƒ± (${order.type}):`, error, order);
    return {};
  }
}

private parseGetirAddress(order: Order): any {
  const address = order.rawData.client?.deliveryAddress;
  if (!address) return {};

  const fullAddress = [
    address.address,
    address.district,
    address.city
  ].filter(Boolean).join(', ');

  return {
    address: fullAddress,
    doorNo: address.doorNo || '',
    floor: address.floor || '',
    description: address.description || '',
    fullAddress
  };
}

private parseYemekSepetiAddress(order: Order): any {
  const address = order.rawData.delivery?.address;
  if (!address) return {};

  let addressLine = '';
  
  // Adres bile≈üenlerini birle≈ütir
  const components = [
    address.street,
    address.number ? `No:${address.number}` : null,
    address.building,
    address.city,
    address.postcode
  ].filter(Boolean);
  
  addressLine = components.join(', ');
  
  if (address.company) {
    addressLine += ` (${address.company})`;
  }

  return {
    address: addressLine.trim(),
    doorNo: address.flatNumber || '',
    floor: address.floor || '',
    description: address.deliveryInstructions || order.rawData.comments?.customerComment || '',
    fullAddress: addressLine.trim()
  };
}

private parseTrendyolAddress(order: Order): any {
  const address = order.rawData.address;
  if (!address) return {};

  const addressComponents = [
    address.address1,
    address.address2,
    address.neighborhood,
    address.district,
    address.city
  ].filter(Boolean);
  
  const fullAddress = addressComponents.join(', ');

  return {
    address: fullAddress,
    doorNo: address.doorNumber || address.apartmentNumber || '',
    floor: address.floor || '',
    description: address.addressDescription || order.rawData.customerNote || '',
    coordinates: address.latitude && address.longitude ? {
      lat: parseFloat(address.latitude),
      lng: parseFloat(address.longitude)
    } : undefined,
    fullAddress
  };
}

private parseMigrosAddress(order: Order): any {
  const rawData: any = order.rawData;
  
  // CustomerInfo'dan adres
  if (rawData.customerInfo?.address) {
    const address = rawData.customerInfo.address;
    const addressLine = [
      address.street,
      address.number ? `No:${address.number}` : null,
      address.detail
    ].filter(Boolean).join(', ');

    return {
      address: addressLine,
      doorNo: address.door || '',
      floor: address.floor || '',
      description: address.direction || '',
      fullAddress: addressLine
    };
  }
  
  // Customer.deliveryAddress'ten adres
  if (rawData.customer?.deliveryAddress) {
    const address = rawData.customer.deliveryAddress;
    
    let addressLine = address.detail || address.address || '';
    
    if (!addressLine) {
      const components = [
        address.streetName,
        address.buildingNumber ? `No:${address.buildingNumber}` : null,
        address.district,
        address.city
      ].filter(Boolean);
      
      addressLine = components.join(', ');
    }

    return {
      address: addressLine,
      doorNo: address.doorNumber || '',
      floor: address.floorNumber || '',
      description: address.direction || '',
      fullAddress: addressLine
    };
  }

  console.warn(`‚ö†Ô∏è Migros sipari≈üinde adres bilgisi bulunamadƒ±:`, rawData.orderId);
  return {};
}
```

Devam edeyim mi? Hen√ºz √ßok fazla detay var:

**Sƒ±rada bekleyenler:**
- üéØ Sipari≈ü onaylama tam algoritmasƒ±
- üì± Platform-specific √ºr√ºn i≈üleme
- üñ®Ô∏è Termal yazdƒ±rma HTML generator
- ‚öôÔ∏è Background sync detaylarƒ±
- üîß Electron integration
- üìä Performance monitoring
- üé® CSS animations
- üîß Build ve deploy

Bu ≈üekilde **10-15 ayrƒ± dosya** olacak, her biri 50-100KB! üöÄ
